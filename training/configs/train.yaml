scene_name: ???
num_persons: ???
exp_name: ???
root_gt_dir_path: ???
preprocessing_dir: /scratch/izar/cizinsky/thesis/preprocessing/${scene_name}
output_dir: /scratch/izar/cizinsky/thesis/results/${scene_name}
input_data_dir: /scratch/izar/cizinsky/thesis/input_data
epochs: 30
batch_size: 5
lr: 1e-4
weight_decay: 5e-4
grad_clip: 0.1
sample_every: 5
eval_every_epoch: 15
train_params:
  - offset_xyz
  - rotation
  - scaling
  - opacity
  - shs
use_bbox_crop: true
bbox_pad: 50
apply_mask_to_render_for_nvs: false
use_random_init: false
nv_gen_epoch: 15 # set to -1 to disable training data augmentation

# train
cameras_scene_dir: ${root_gt_dir_path}
frames_scene_dir: ${preprocessing_dir}
masks_scene_dir: ${preprocessing_dir}
use_estimated_masks: true
mask_estimator_kind: "rgb_render_based" # "rgb_render_based", "smplx_mesh_based", "rgb_smplx_band", "src_reprojection"
smplx_params_scene_dir: ${preprocessing_dir} # we use this for the movement of 3dgs during training
depths_scene_dir: ${preprocessing_dir}  
smpl_params_scene_dir: ${preprocessing_dir} # for now, this is just here to be able to compute pose metrics during eval, these are derived from smplx params
use_depth: true

# test
test_cameras_scene_dir: ${root_gt_dir_path}
test_frames_scene_dir: ${root_gt_dir_path}
test_masks_scene_dir: ${root_gt_dir_path}
test_smplx_params_scene_dir: ${root_gt_dir_path}
test_depths_scene_dir: null  # ${root_gt_dir_path}  # set to null if no depths are used
test_smpl_params_scene_dir: ${root_gt_dir_path}
test_meshes_scene_dir: ${root_gt_dir_path}  # for now, this is just here to be able to compute mesh metrics during eval 

difix:
  eval_enable: false
  trn_enable: true
  is_prev_cam_always_source: false
  model_id: "nvidia/difix_ref"
  prompt: "remove degradation"
  negative_prompt: null
  num_inference_steps: 1
  timesteps: [199]
  guidance_scale: 0.0
  overwrite_existing: false
  resolution_multiple: 8

trn_nv_gen:
  camera_ids: [4,16,28,40,52,64,76,88]


wandb:
  enable: true
  project: "hybrid-lhm"
  entity: "ludekcizinsky"
  tags:
    - using_v2_bas_difix
    - eval

loss_weights:
  rgb: 20.0
  sil: 4.0
  ssim: 0.4
  depth: 0.0 # for now disabled because I have unreliable depth maps for nvs
  interpenetration: 0.1

# Interpenetration loss (posed GS overlap)
interpenetration_margin: 0.01   # meters
interpenetration_max_points: 2000

# Pose tuning (SMPL-X)
pose_tuning:
  enable: true
  params: ["root_pose", "body_pose", "trans", "betas"]
  lr: 1e-4
  reg_w: 1e-4
  start_epoch: 0
  end_epoch: 14

# 3DGS tuning
gs_tuning:
  start_epoch: 15
  end_epoch: ${epochs}

regularization:
  asap_w: 200.0
  acap_w: 200.0
  acap_margin: 0.01 # meters (1 cm)

eval_pretrain: true
nvs_eval:
  source_camera_id: 4
  target_camera_ids: [4, 16, 28, 40, 52, 64, 76, 88]
  downscale_factor: 2

gs_to_mesh_method: tsdf # options: tsdf, mc

reconstruction_eval:
  icp:
    n_samples: 1000
    max_iterations: 10
    threshold: 1e-4
  viou:
    voxel_size: 0.02
    padding: 0.05
  metrics:
    n_samples: 1000
    units: cm

torch_home: /scratch/izar/cizinsky/.cache
hf_home: /scratch/izar/cizinsky/.cache

hydra:
  run:
    dir: /scratch/izar/cizinsky/thesis/hydra/${now:%Y-%m-%d}_${now:%H-%M-%S}
  job:
    chdir: False
